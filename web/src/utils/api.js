export const api=async(p,o={})=>{const h={'Content-Type':'application/json',...(o.headers||{})};const k=localStorage.getItem('admin_key');if(k&&(!o.method||o.method!=='GET'))h['x-key']=k;const r=await fetch(p,{...o,headers:h});if(!r.ok){let e={};try{e=await r.json()}catch{};throw new Error(e.error||'Request failed')}return r.headers.get('content-type')?.includes('text/csv')?r.text():r.json()}